<!DOCTYPE html>

<html lang="en" data-content_root="./">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Database API &#8212; OsuArena 0.1 documentation</title>
    <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=5ecbeea2" />
    <link rel="stylesheet" type="text/css" href="_static/basic.css?v=b08954a9" />
    <link rel="stylesheet" type="text/css" href="_static/alabaster.css?v=27fed22d" />
    <script src="_static/documentation_options.js?v=2709fde1"></script>
    <script src="_static/doctools.js?v=fd6eb6e6"></script>
    <script src="_static/sphinx_highlight.js?v=6ffebe34"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="prev" title="OsuArena documentation" href="index.html" />
   
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  

  
  

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="module-utils_v2.db_handler">
<span id="database-api"></span><h1>Database API<a class="headerlink" href="#module-utils_v2.db_handler" title="Link to this heading">¶</a></h1>
<p>Every functionality that requires access to the database goes through this class.
Common class for both the website and the bot for database access</p>
<dl class="py class">
<dt class="sig sig-object py" id="utils_v2.db_handler.DatabaseHandler">
<span class="property"><span class="k"><span class="pre">class</span></span><span class="w"> </span></span><span class="sig-prename descclassname"><span class="pre">utils_v2.db_handler.</span></span><span class="sig-name descname"><span class="pre">DatabaseHandler</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">log_handler</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">LogHandler</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">supabase_client</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">AsyncClient</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/utils_v2/db_handler.html#DatabaseHandler"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#utils_v2.db_handler.DatabaseHandler" title="Link to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></p>
<p>Represents an interface for interacting with the PostgreSQL database via Supabase.</p>
<p>This class handles data retrieval and formatting for operations across
both the Discord bot and the web dashboard.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>log_handler</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">LogHandler</span></code>) – The logger used for error handling and exception reporting.
Typically, this should be an existing instance configured for
either the bot or the web application.</p></li>
<li><p><strong>supabase_client</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">supabase.AsyncClient</span></code>) – The asynchronous client used to communicate with the Supabase API.</p></li>
</ul>
</dd>
</dl>
<dl class="py method">
<dt class="sig sig-object py" id="utils_v2.db_handler.DatabaseHandler.accept_challenge">
<span class="property"><span class="k"><span class="pre">async</span></span><span class="w"> </span></span><span class="sig-name descname"><span class="pre">accept_challenge</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">challange_id</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">list</span><span class="p"><span class="pre">[</span></span><span class="pre">int</span><span class="p"><span class="pre">]</span></span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span></span><a class="reference internal" href="_modules/utils_v2/db_handler.html#DatabaseHandler.accept_challenge"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#utils_v2.db_handler.DatabaseHandler.accept_challenge" title="Link to this definition">¶</a></dt>
<dd><p><strong>(coroutine)</strong>
Marks a specific challenge as accepted(Pending -&gt; Unfinishd) in the rivals table.</p>
<p>This calls the Supabase RPC <code class="docutils literal notranslate"><span class="pre">accept_challenge</span></code>, which updates the match status
as well as logs in the accepted date (now) and current pp as ‘initial_pp’.
It returns discord_id of the two rivals players as well as the number of pp they
playing for, this will be used to later make announcement in the public discord
channel.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>challenge_id</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code>) – The unique ID of the challenge to accept.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>A list containing <code class="docutils literal notranslate"><span class="pre">[challenger_id,</span> <span class="pre">challenged_id,</span> <span class="pre">for_pp]</span></code> if successful.
Returns <code class="docutils literal notranslate"><span class="pre">None</span></code> if the challenge ID was not found or an error occurred.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><code class="xref py py-class docutils literal notranslate"><span class="pre">list`[:class:`int</span></code>] | None</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="utils_v2.db_handler.DatabaseHandler.add_points">
<span class="property"><span class="k"><span class="pre">async</span></span><span class="w"> </span></span><span class="sig-name descname"><span class="pre">add_points</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">points</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">discord_id</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">osu_uname</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">dict</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">bool</span></span></span><a class="reference internal" href="_modules/utils_v2/db_handler.html#DatabaseHandler.add_points"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#utils_v2.db_handler.DatabaseHandler.add_points" title="Link to this definition">¶</a></dt>
<dd><p><strong>(coroutine)</strong>
Adds points to a user’s account via a database RPC function (<cite>add_points</cite>)</p>
<p>You must provide either a <code class="docutils literal notranslate"><span class="pre">discord_id</span></code> (which will be resolved to a username)
or the <code class="docutils literal notranslate"><span class="pre">osu_username</span></code> directly. Exactly one parameter required at a time.</p>
<p>Accesses table : discord_osu</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>points</strong> (class:<cite>int</cite>) – The amount of points to add.</p></li>
<li><p><strong>discord_id</strong> (class:<cite>int</cite> | None) – The user’s Discord ID.</p></li>
<li><p><strong>osu_username</strong> (class:<cite>str</cite> | None) – The user’s osu! username.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>The updated row data (as a dict) if successful, or <code class="docutils literal notranslate"><span class="pre">False</span></code> on failure.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>dict[str, Any] | bool</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="utils_v2.db_handler.DatabaseHandler.backup_seasonal_points">
<span class="property"><span class="k"><span class="pre">async</span></span><span class="w"> </span></span><span class="sig-name descname"><span class="pre">backup_seasonal_points</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">season_number</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">FuncStatus</span></span></span><a class="reference internal" href="_modules/utils_v2/db_handler.html#DatabaseHandler.backup_seasonal_points"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#utils_v2.db_handler.DatabaseHandler.backup_seasonal_points" title="Link to this definition">¶</a></dt>
<dd><p><strong>(coroutine)</strong>
Backs up the current seasonal points from discord_osu table to column in
historical_points table.</p>
<p>Calls the RPC <code class="docutils literal notranslate"><span class="pre">backup_historical_points</span></code>, which copies the current points
into a dynamic column named <code class="docutils literal notranslate"><span class="pre">season_{number}</span></code>.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>season_number</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code>) – The season number to use for the column suffix (e.g., 4 for <code class="docutils literal notranslate"><span class="pre">season_4</span></code>).</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><code class="docutils literal notranslate"><span class="pre">FuncStatus.GOOD</span></code> if successful, <code class="docutils literal notranslate"><span class="pre">FuncStatus.ERROR</span></code> otherwise.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><code class="xref py py-class docutils literal notranslate"><span class="pre">FuncStatus</span></code></p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="utils_v2.db_handler.DatabaseHandler.check_challenge_eligibility">
<span class="property"><span class="k"><span class="pre">async</span></span><span class="w"> </span></span><span class="sig-name descname"><span class="pre">check_challenge_eligibility</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">challenger_id</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">challenged_id</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">ChallengeFailed</span></span></span><a class="reference internal" href="_modules/utils_v2/db_handler.html#DatabaseHandler.check_challenge_eligibility"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#utils_v2.db_handler.DatabaseHandler.check_challenge_eligibility" title="Link to this definition">¶</a></dt>
<dd><p><strong>(coroutine)</strong>
Determines if a user is eligible to challenge another user based on their challenge history.</p>
<p>This function acts as an orchestrator. It resolves Discord IDs to osu!
usernames, fetches the match history between the two players, and passes
that data to the rule validator.</p>
<p><strong>Rule Checks:</strong>
1. Checks for any challenges between the pair within the last 24 hours.
2. Checks for any currently unfinished or pending challenges.</p>
<p>Internal calls: <a class="reference internal" href="#utils_v2.db_handler.DatabaseHandler.get_username" title="utils_v2.db_handler.DatabaseHandler.get_username"><code class="xref py py-meth docutils literal notranslate"><span class="pre">get_username()</span></code></a>, <code class="xref py py-meth docutils literal notranslate"><span class="pre">_fetch_rivals_history()</span></code></p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>challenger_id</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code>) – The Discord ID of the user initiating the challenge.</p></li>
<li><p><strong>challenged_id</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code>) – The Discord ID of the user receiving the challenge.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><p>The status of the eligibility check:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">ChallengeFailed.GOOD</span></code>: The users are eligible to challenge.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ChallengeFailed.PENDING</span></code>: A pending challenge already exists between the two.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ChallengeFailed.ONGOING</span></code>: An unfinished challenge exists between the two.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ChallengeFailed.TOO_EARLY</span></code>: A challenge (of any status) occurred within the last 24 hours.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ChallengeFailed.BAD_LINK</span></code>: One or both users are not linked to the system.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ChallengeFailed.FAILED</span></code>: An internal database error prevented the check.</p></li>
</ul>
</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><code class="xref py py-class docutils literal notranslate"><span class="pre">ChallengeFailed</span></code></p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="utils_v2.db_handler.DatabaseHandler.check_if_player_exists">
<span class="property"><span class="k"><span class="pre">async</span></span><span class="w"> </span></span><span class="sig-name descname"><span class="pre">check_if_player_exists</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">discord_id</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">bool</span></span></span><a class="reference internal" href="_modules/utils_v2/db_handler.html#DatabaseHandler.check_if_player_exists"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#utils_v2.db_handler.DatabaseHandler.check_if_player_exists" title="Link to this definition">¶</a></dt>
<dd><p><strong>(coroutine)</strong>
Checks if a user is registered in the system.</p>
<p>This performs a lightweight “head” query (fetching only the count, not the data)
to the <code class="xref py py-attr docutils literal notranslate"><span class="pre">DISCORD_OSU</span></code> table to verify their existence.</p>
<p>Accesses table : discord_osu</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>discord_id</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code>) – The unique Discord ID to check.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><code class="docutils literal notranslate"><span class="pre">True</span></code> if the user exists in the database, <code class="docutils literal notranslate"><span class="pre">False</span></code> otherwise.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><code class="xref py py-class docutils literal notranslate"><span class="pre">bool</span></code></p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="utils_v2.db_handler.DatabaseHandler.check_pending">
<span class="property"><span class="k"><span class="pre">async</span></span><span class="w"> </span></span><span class="sig-name descname"><span class="pre">check_pending</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">challenger_id</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">challenged_id</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">int</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span></span><a class="reference internal" href="_modules/utils_v2/db_handler.html#DatabaseHandler.check_pending"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#utils_v2.db_handler.DatabaseHandler.check_pending" title="Link to this definition">¶</a></dt>
<dd><p><strong>(coroutine)</strong>
Checks if a pending challenge exists between two users. Used when someone Accepts
a challenge. This function is called to verify that such challenge exists.</p>
<p>This queries the <code class="xref py py-attr docutils literal notranslate"><span class="pre">RIVALS</span></code> table for any row connecting
these two users where the status is <code class="docutils literal notranslate"><span class="pre">ChallengeStatus.PENDING</span></code>.</p>
<p>Accesses table : rivals</p>
<p>Internal calls: <a class="reference internal" href="#utils_v2.db_handler.DatabaseHandler.get_username" title="utils_v2.db_handler.DatabaseHandler.get_username"><code class="xref py py-meth docutils literal notranslate"><span class="pre">get_username()</span></code></a></p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>challenger_id</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code>) – The Discord ID of the potential challenger.</p></li>
<li><p><strong>challenged_id</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code>) – The Discord ID of the potential challenge recipient.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>The <code class="docutils literal notranslate"><span class="pre">challenge_id</span></code> if a pending challenge exists.
Returns <code class="docutils literal notranslate"><span class="pre">None</span></code> if no pending challenge is found or an error occurs.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code> | None</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="utils_v2.db_handler.DatabaseHandler.check_player_existence_for_points">
<span class="property"><span class="k"><span class="pre">async</span></span><span class="w"> </span></span><span class="sig-name descname"><span class="pre">check_player_existence_for_points</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">discord_id</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">list</span><span class="p"><span class="pre">[</span></span><span class="pre">dict</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">Any</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span></span></span><a class="reference internal" href="_modules/utils_v2/db_handler.html#DatabaseHandler.check_player_existence_for_points"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#utils_v2.db_handler.DatabaseHandler.check_player_existence_for_points" title="Link to this definition">¶</a></dt>
<dd><p><strong>(coroutine)</strong>
This function’s is used when /point command is called and is used to
verify if the given player exist in the database and report back their
points if they do.</p>
<p>Queries the main discord_osu table for the user’s total and seasonal points.</p>
<p>Accesses table : discord_osu</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>discord_id</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code>) – The Discord ID of the user to check.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>A dictionary containing <code class="docutils literal notranslate"><span class="pre">{'points':</span> <span class="pre">...,</span> <span class="pre">'seasonal_points':</span> <span class="pre">...}</span></code> if found.
Returns <code class="docutils literal notranslate"><span class="pre">FuncStatus.EMPTY</span></code> if the user does not exist.
Returns <code class="docutils literal notranslate"><span class="pre">FuncStatus.ERROR</span></code> if the database query fails.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><code class="xref py py-class docutils literal notranslate"><span class="pre">dict`[:class:`str</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">Any</span></code>] | <code class="xref py py-class docutils literal notranslate"><span class="pre">FuncStatus</span></code></p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="utils_v2.db_handler.DatabaseHandler.decline_challenge">
<span class="property"><span class="k"><span class="pre">async</span></span><span class="w"> </span></span><span class="sig-name descname"><span class="pre">decline_challenge</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">challange_id</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">list</span><span class="p"><span class="pre">[</span></span><span class="pre">int</span><span class="p"><span class="pre">]</span></span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span></span><a class="reference internal" href="_modules/utils_v2/db_handler.html#DatabaseHandler.decline_challenge"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#utils_v2.db_handler.DatabaseHandler.decline_challenge" title="Link to this definition">¶</a></dt>
<dd><p><strong>(coroutine)</strong>
Marks a specific challenge as declined (Pending -&gt; Declined) in the rivals table.</p>
<p>This calls the Supabase RPC <code class="docutils literal notranslate"><span class="pre">decline_challenge</span></code>, which updates the match status
to mark it as declined. Also updates the ‘ended_at’ column of rivals tables to log in
the time right now. It returns the discord_id of the two rival players which will be
used to notify in the public channel that this challenge was declined</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>challenge_id</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code>) – The unique ID of the challenge to decline.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>A list containing <code class="docutils literal notranslate"><span class="pre">[challenger_id,</span> <span class="pre">challenged_id,</span> <span class="pre">for_pp]</span></code> if successful.
Returns <code class="docutils literal notranslate"><span class="pre">None</span></code> if the challenge ID was not found or an error occurred.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><code class="xref py py-class docutils literal notranslate"><span class="pre">list`[:class:`int</span></code>] | None</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="utils_v2.db_handler.DatabaseHandler.duplicate_table">
<span class="property"><span class="k"><span class="pre">async</span></span><span class="w"> </span></span><span class="sig-name descname"><span class="pre">duplicate_table</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">league</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">season</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">FuncStatus</span></span></span><a class="reference internal" href="_modules/utils_v2/db_handler.html#DatabaseHandler.duplicate_table"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#utils_v2.db_handler.DatabaseHandler.duplicate_table" title="Link to this definition">¶</a></dt>
<dd><p><strong>(coroutine)</strong>
Creates an archival copy of a league table for a specific season.</p>
<p>Calls the RPC <code class="docutils literal notranslate"><span class="pre">duplicate_table</span></code> to copy the data from the active league
table (e.g., “gold”) to a new archival table (e.g., “gold_4”).</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>league</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code>) – The name of the league to backup (e.g., “gold”).</p></li>
<li><p><strong>season</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code>) – The season number to append to the new table name.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><code class="docutils literal notranslate"><span class="pre">FuncStatus.GOOD</span></code> if successful, <code class="docutils literal notranslate"><span class="pre">FuncStatus.ERROR</span></code> otherwise.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><code class="xref py py-class docutils literal notranslate"><span class="pre">FuncStatus</span></code></p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="utils_v2.db_handler.DatabaseHandler.get_active_challenge_count">
<span class="property"><span class="k"><span class="pre">async</span></span><span class="w"> </span></span><span class="sig-name descname"><span class="pre">get_active_challenge_count</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">discord_id</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">int</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span></span><a class="reference internal" href="_modules/utils_v2/db_handler.html#DatabaseHandler.get_active_challenge_count"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#utils_v2.db_handler.DatabaseHandler.get_active_challenge_count" title="Link to this definition">¶</a></dt>
<dd><p><strong>(coroutine)</strong>
Calculates the total number of active challenges for a specific user.</p>
<p>This checks both the ‘challenger’ and ‘challenged’ columns to count
how many Unfinished/ Pending challenges the user is currently involved in.</p>
<p>Accesses tables = f”{TablesRivals.(any)}”</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>discord_id</strong> (class:<cite>int</cite>) – The user’s unique Discord ID.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>The total count of active challenges.
Returns <code class="docutils literal notranslate"><span class="pre">None</span></code> if a database lookup fails 0 if not challenge for the player exists.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>int | None</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="utils_v2.db_handler.DatabaseHandler.get_active_challenges">
<span class="property"><span class="k"><span class="pre">async</span></span><span class="w"> </span></span><span class="sig-name descname"><span class="pre">get_active_challenges</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">discord_id</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">osu_username</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">list</span><span class="p"><span class="pre">[</span></span><span class="pre">dict</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">Any</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">FuncStatus</span></span></span><a class="reference internal" href="_modules/utils_v2/db_handler.html#DatabaseHandler.get_active_challenges"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#utils_v2.db_handler.DatabaseHandler.get_active_challenges" title="Link to this definition">¶</a></dt>
<dd><p><strong>(coroutine)</strong>
Retrieves all active challenges (Pending or Unfinished) for a specific user.
(This function is currently NOT in use anywhere, just here in case I make
a functionality to have individual player’s profiles)</p>
<p>This checks both the “challenger” and “challenged” columns to find any
involvement the user has in ongoing matches.</p>
<p>Accessses tables : f”{TableRivals.(any)}”</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>discord_id</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code>) – The Discord ID of the user (used primarily for error logging).</p></li>
<li><p><strong>osu_username</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code>) – The user’s osu! username (used for the database query).</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>A list of dictionary objects representing the active challenges.
Returns an empty list <code class="docutils literal notranslate"><span class="pre">[]</span></code> if no active challenges are found.
Returns <code class="docutils literal notranslate"><span class="pre">FuncStatus.ERROR</span></code> if the query fails.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><code class="xref py py-class docutils literal notranslate"><span class="pre">list`[:class:`dict`[:class:`str</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">Any</span></code>]] | <code class="xref py py-class docutils literal notranslate"><span class="pre">FuncStatus</span></code></p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="utils_v2.db_handler.DatabaseHandler.get_archived_league_table">
<span class="property"><span class="k"><span class="pre">async</span></span><span class="w"> </span></span><span class="sig-name descname"><span class="pre">get_archived_league_table</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">league</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">season</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">tuple</span><span class="p"><span class="pre">[</span></span><span class="pre">list</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">list</span><span class="p"><span class="pre">[</span></span><span class="pre">tuple</span><span class="p"><span class="pre">[</span></span><span class="pre">Any</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span></span></span><a class="reference internal" href="_modules/utils_v2/db_handler.html#DatabaseHandler.get_archived_league_table"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#utils_v2.db_handler.DatabaseHandler.get_archived_league_table" title="Link to this definition">¶</a></dt>
<dd><p><strong>(coroutine)</strong>
Retrieves historical standings for a specific past season.</p>
<p>This constructs the archived table name (e.g., “silver_1”) and fetches
the data.</p>
<p>Accesses table : f”{ArchivedTable.(any)}”</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>league</strong> (class:<cite>str</cite>) – The name of the league (e.g., “silver”).</p></li>
<li><p><strong>season</strong> (class:<cite>int</cite>) – The season number to retrieve.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>A tuple containing headers and row data for the archived season.
Returns <code class="docutils literal notranslate"><span class="pre">([],</span> <span class="pre">[])</span></code> if the table does not exist.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>tuple[list[str], list[tuple[Any]]]</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="utils_v2.db_handler.DatabaseHandler.get_archived_points">
<span class="property"><span class="k"><span class="pre">async</span></span><span class="w"> </span></span><span class="sig-name descname"><span class="pre">get_archived_points</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">season</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">tuple</span><span class="p"><span class="pre">[</span></span><span class="pre">list</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">list</span><span class="p"><span class="pre">[</span></span><span class="pre">tuple</span><span class="p"><span class="pre">[</span></span><span class="pre">Any</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span></span></span><a class="reference internal" href="_modules/utils_v2/db_handler.html#DatabaseHandler.get_archived_points"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#utils_v2.db_handler.DatabaseHandler.get_archived_points" title="Link to this definition">¶</a></dt>
<dd><p><strong>(coroutine)</strong>
Retrieves the data for top 15 point scorers for a specific past season.</p>
<p>This queries the historical points table, selecting the column
corresponding to the requested season (e.g., <code class="docutils literal notranslate"><span class="pre">season_3</span></code>) and aliasing
it to <code class="docutils literal notranslate"><span class="pre">points</span></code> for formatting purposes.</p>
<p>Accesses table : historical_points</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>season</strong> (class:<cite>int</cite>) – The season number to retrieve data for.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>A tuple containing headers and the top 15 rows of data.
Returns <code class="docutils literal notranslate"><span class="pre">([],</span> <span class="pre">[])</span></code> if the season data is missing or an error occurs.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>tuple[list[str], list[tuple[Any]]]</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="utils_v2.db_handler.DatabaseHandler.get_archived_season">
<span class="property"><span class="k"><span class="pre">async</span></span><span class="w"> </span></span><span class="sig-name descname"><span class="pre">get_archived_season</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">list</span><span class="p"><span class="pre">[</span></span><span class="pre">int</span><span class="p"><span class="pre">]</span></span></span></span><a class="reference internal" href="_modules/utils_v2/db_handler.html#DatabaseHandler.get_archived_season"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#utils_v2.db_handler.DatabaseHandler.get_archived_season" title="Link to this definition">¶</a></dt>
<dd><p><strong>(coroutine)</strong>
Retrieves a list of all season numbers that are currently archived.</p>
<p>Accesses table : seasons</p>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>A list of season integers (e.g., <code class="docutils literal notranslate"><span class="pre">[1,</span> <span class="pre">2,</span> <span class="pre">3]</span></code>).
Returns an empty list (<code class="docutils literal notranslate"><span class="pre">[]</span></code>) if no archived seasons are found or and error occurs.</p>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p>list[int]</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="utils_v2.db_handler.DatabaseHandler.get_current_league_table">
<span class="property"><span class="k"><span class="pre">async</span></span><span class="w"> </span></span><span class="sig-name descname"><span class="pre">get_current_league_table</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">league</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">tuple</span><span class="p"><span class="pre">[</span></span><span class="pre">list</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">list</span><span class="p"><span class="pre">[</span></span><span class="pre">tuple</span><span class="p"><span class="pre">[</span></span><span class="pre">Any</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span></span></span><a class="reference internal" href="_modules/utils_v2/db_handler.html#DatabaseHandler.get_current_league_table"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#utils_v2.db_handler.DatabaseHandler.get_current_league_table" title="Link to this definition">¶</a></dt>
<dd><p><strong>(coroutine)</strong>
Retrieves the current standings for a specific league.</p>
<p>This method first triggers a remote procedure call (<code class="docutils literal notranslate"><span class="pre">sync_table_pp</span></code>)
to ensure all player performance points are up-to-date, and then
fetches the sorted league data.</p>
<p>Accesses table : f”{TablesLeagues.(any)}”</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>league</strong> (class:<cite>str</cite>) – The name of the league table to retrieve (e.g., “silver”, “gold”).</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>A tuple containing:
1. A list of column headers (strings).
2. A list of rows, where each row is a tuple of values.
Returns <code class="docutils literal notranslate"><span class="pre">([],</span> <span class="pre">[])</span></code> if the synchronization or fetch fails.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>tuple[list[str], list[tuple[Any]]]</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="utils_v2.db_handler.DatabaseHandler.get_current_points">
<span class="property"><span class="k"><span class="pre">async</span></span><span class="w"> </span></span><span class="sig-name descname"><span class="pre">get_current_points</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">point_type</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">tuple</span><span class="p"><span class="pre">[</span></span><span class="pre">list</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">list</span><span class="p"><span class="pre">[</span></span><span class="pre">tuple</span><span class="p"><span class="pre">[</span></span><span class="pre">Any</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span></span></span><a class="reference internal" href="_modules/utils_v2/db_handler.html#DatabaseHandler.get_current_points"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#utils_v2.db_handler.DatabaseHandler.get_current_points" title="Link to this definition">¶</a></dt>
<dd><p><strong>(coroutine)</strong>
Retrieves the top 15 players for (Univseral/ Seasonal) point category.</p>
<p>This queries the discord_osu table to fetch rankings based on the
given points-type column.</p>
<p>Accesses table : discord_osu</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>point_type</strong> (class:<cite>str</cite>) – The database column name of the point type to retrieve.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>A tuple containing headers and the top 15 rows of data.
Returns <code class="docutils literal notranslate"><span class="pre">([],</span> <span class="pre">[])</span></code> if no data is found or on error.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>tuple[list[str], list[tuple[Any]]]</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="utils_v2.db_handler.DatabaseHandler.get_current_season">
<span class="property"><span class="k"><span class="pre">async</span></span><span class="w"> </span></span><span class="sig-name descname"><span class="pre">get_current_season</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">int</span></span></span><a class="reference internal" href="_modules/utils_v2/db_handler.html#DatabaseHandler.get_current_season"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#utils_v2.db_handler.DatabaseHandler.get_current_season" title="Link to this definition">¶</a></dt>
<dd><p><strong>(coroutine)</strong>
Retrieves the season number of the currently ongoing season. Used for
/season-reset command right now</p>
<p>It queries the <code class="xref py py-attr docutils literal notranslate"><span class="pre">SEASONS</span></code> table for a row where
the status is <code class="docutils literal notranslate"><span class="pre">SeasonStatus.ONGOING</span></code>.</p>
<p>Accesses table : seasons</p>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>The current season number if found.
Returns <code class="docutils literal notranslate"><span class="pre">None</span></code> if no ongoing season exists or if an error occurs.</p>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p><code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code> | None</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="utils_v2.db_handler.DatabaseHandler.get_discord_id">
<span class="property"><span class="k"><span class="pre">async</span></span><span class="w"> </span></span><span class="sig-name descname"><span class="pre">get_discord_id</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">osu_username</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">discord_username</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">int</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span></span><a class="reference internal" href="_modules/utils_v2/db_handler.html#DatabaseHandler.get_discord_id"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#utils_v2.db_handler.DatabaseHandler.get_discord_id" title="Link to this definition">¶</a></dt>
<dd><p><strong>(coroutine)</strong>
A coroutine to access a user’s discord_id through their osu/discord username.
Give only one of the two arguments at a time
Accesses table : discord_osu</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>osu_username</strong> (class:<cite>str</cite>) – user’s osu username</p></li>
<li><p><strong>discord_username</strong> (class:<cite>str</cite>)</p></li>
<li><p><strong>username</strong> (<em>user's discord</em>)</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>The discord_id of the corresponding user if it exists</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>int | None</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="utils_v2.db_handler.DatabaseHandler.get_msg_id">
<span class="property"><span class="k"><span class="pre">async</span></span><span class="w"> </span></span><span class="sig-name descname"><span class="pre">get_msg_id</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">challenge_id</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">int</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span></span><a class="reference internal" href="_modules/utils_v2/db_handler.html#DatabaseHandler.get_msg_id"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#utils_v2.db_handler.DatabaseHandler.get_msg_id" title="Link to this definition">¶</a></dt>
<dd><p><strong>(coroutine)</strong>
A coroutine to access the message ID associated with a specific challenge.
Accesses table : mesg_id</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>challenge_id</strong> (class:<cite>int</cite>) – The unique identifier of the challenge.
Usually assigned when a new challenge is created in rivals table</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>The message ID if it exists, otherwise <code class="docutils literal notranslate"><span class="pre">None</span></code>.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>int | None</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="utils_v2.db_handler.DatabaseHandler.get_player">
<span class="property"><span class="k"><span class="pre">async</span></span><span class="w"> </span></span><span class="sig-name descname"><span class="pre">get_player</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">discord_id</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">dict</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">Any</span><span class="p"><span class="pre">]</span></span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">FuncStatus</span></span></span><a class="reference internal" href="_modules/utils_v2/db_handler.html#DatabaseHandler.get_player"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#utils_v2.db_handler.DatabaseHandler.get_player" title="Link to this definition">¶</a></dt>
<dd><p><strong>(coroutine)</strong>
Retrieves a user’s osu_username, initial_pp and their current_league
based on their discord_id. This is to display them on /dashboard in the
web.</p>
<p>This is a two-step process:</p>
<p>1. Fetches basic info (username, pp(this one’s useless, wanna remove it but
don’t wanna break anything just in case), league) from the discord_osu table.
2. Calls <code class="xref py py-meth docutils literal notranslate"><span class="pre">_get_player_from_league()</span></code> to fetch rank and stats from the
specific league table (e.g., “gold” or “silver”).</p>
<p>Accesses tables : discord_osu , f”{TableLeague.(any)}”</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>discord_id</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code>) – The Discord ID of the user to retrieve.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>A dictionary containing the full player profile if successful.
Returns <code class="docutils literal notranslate"><span class="pre">None</span></code> if the player is not found in the main table.
Returns <code class="docutils literal notranslate"><span class="pre">FuncStatus.ERROR</span></code> if an internal error occurs.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><code class="xref py py-class docutils literal notranslate"><span class="pre">dict`[:class:`str</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">Any</span></code>] | None | <code class="xref py py-class docutils literal notranslate"><span class="pre">FuncStatus</span></code></p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="utils_v2.db_handler.DatabaseHandler.get_rivals_table">
<span class="property"><span class="k"><span class="pre">async</span></span><span class="w"> </span></span><span class="sig-name descname"><span class="pre">get_rivals_table</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">status</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">tuple</span><span class="p"><span class="pre">[</span></span><span class="pre">list</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">list</span><span class="p"><span class="pre">[</span></span><span class="pre">tuple</span><span class="p"><span class="pre">[</span></span><span class="pre">Any</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span></span></span><a class="reference internal" href="_modules/utils_v2/db_handler.html#DatabaseHandler.get_rivals_table"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#utils_v2.db_handler.DatabaseHandler.get_rivals_table" title="Link to this definition">¶</a></dt>
<dd><p><strong>(coroutine)</strong>
Retrieves the rivals table filtered by challenge status.</p>
<p>This method first triggers a remote procedure call (<code class="docutils literal notranslate"><span class="pre">sync_rivals</span></code>)
to ensure match statistics are up-to-date. The columns returned vary
depending on whether the status is ‘Unfinished’ or ‘Finished’.</p>
<p>When passing the status it’s recommended you pass it as an attribute of
ChallengeStatus class.</p>
<p>Accesses table : rivals</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>status</strong> (class:<cite>str</cite>) – The status to filter by (e.g., <code class="docutils literal notranslate"><span class="pre">ChallengeStatus.UNFINISHED</span></code>).</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>A tuple containing headers and formatted row data.
Returns <code class="docutils literal notranslate"><span class="pre">([],</span> <span class="pre">[])</span></code> on failure or if no data is found.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>tuple[list[str], list[tuple[Any]]]</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="utils_v2.db_handler.DatabaseHandler.get_username">
<span class="property"><span class="k"><span class="pre">async</span></span><span class="w"> </span></span><span class="sig-name descname"><span class="pre">get_username</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">discord_id</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">str</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span></span><a class="reference internal" href="_modules/utils_v2/db_handler.html#DatabaseHandler.get_username"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#utils_v2.db_handler.DatabaseHandler.get_username" title="Link to this definition">¶</a></dt>
<dd><p><strong>(coroutine)</strong>
A coroutine to access a user’s osu! username through their discord_id.
Accesses table : discord_osu</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>discord_id</strong> (class:<cite>int</cite>) – The user’s unique Discord ID.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>The osu! username of the corresponding user if it exists.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>str | None</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="utils_v2.db_handler.DatabaseHandler.log_rivals">
<span class="property"><span class="k"><span class="pre">async</span></span><span class="w"> </span></span><span class="sig-name descname"><span class="pre">log_rivals</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">challenger</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Member</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">challenged</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Member</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">for_pp</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">league</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">dict</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">Any</span><span class="p"><span class="pre">]</span></span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span></span><a class="reference internal" href="_modules/utils_v2/db_handler.html#DatabaseHandler.log_rivals"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#utils_v2.db_handler.DatabaseHandler.log_rivals" title="Link to this definition">¶</a></dt>
<dd><p><strong>(coroutine)</strong>
Initiates and logs a new challenge match between two users.</p>
<p>This method performs a two-step logging process:</p>
<ol class="arabic simple">
<li><p>Calls the Supabase RPC <code class="docutils literal notranslate"><span class="pre">log_rivals</span></code> to create the primary match record in rivals table.</p></li>
<li><p>Calls <code class="xref py py-meth docutils literal notranslate"><span class="pre">_log_to_challenge_tables()</span></code> to populate the auxillary tables challenged and challenger</p></li>
</ol>
<p>Internal calls: <a class="reference internal" href="#utils_v2.db_handler.DatabaseHandler.get_username" title="utils_v2.db_handler.DatabaseHandler.get_username"><code class="xref py py-meth docutils literal notranslate"><span class="pre">get_username()</span></code></a>, <code class="xref py py-meth docutils literal notranslate"><span class="pre">_log_to_challenge_tables()</span></code></p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>challenger</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">discord.Member</span></code>) – The Discord member object of the user initiating the challenge.</p></li>
<li><p><strong>challenged</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">discord.Member</span></code>) – The Discord member object of the user receiving the challenge.</p></li>
<li><p><strong>for_pp</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code>) – The amount of points (PP) effectively wagered on this match.</p></li>
<li><p><strong>league</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code>) – The identifier of the league this match belongs to (e.g., “gold”).</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>The data returned by the database RPC if successful (usually containing the new Match ID).
Returns <code class="docutils literal notranslate"><span class="pre">None</span></code> if an error occurs during the logging process.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><code class="xref py py-class docutils literal notranslate"><span class="pre">dict</span></code> | None</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="utils_v2.db_handler.DatabaseHandler.mark_season_archived">
<span class="property"><span class="k"><span class="pre">async</span></span><span class="w"> </span></span><span class="sig-name descname"><span class="pre">mark_season_archived</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">season</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">bool</span></span></span><a class="reference internal" href="_modules/utils_v2/db_handler.html#DatabaseHandler.mark_season_archived"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#utils_v2.db_handler.DatabaseHandler.mark_season_archived" title="Link to this definition">¶</a></dt>
<dd><p><strong>(coroutine)</strong>
Updates the status of a specific season from ONGOING to ARCHIVED.</p>
<p>This is typically called at the end of a season (done with /season-reset)
to lock it before starting a new one.</p>
<p>Accesses table : seasons</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>season</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code>) – The season number to archive.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><code class="docutils literal notranslate"><span class="pre">True</span></code> if the update was successful (rows were modified).
<code class="docutils literal notranslate"><span class="pre">False</span></code> if the season was not found, was not ongoing, or an error occurred.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><code class="xref py py-class docutils literal notranslate"><span class="pre">bool</span></code></p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="utils_v2.db_handler.DatabaseHandler.negate_new_player_announce">
<span class="property"><span class="k"><span class="pre">async</span></span><span class="w"> </span></span><span class="sig-name descname"><span class="pre">negate_new_player_announce</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">discord_id</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">bool</span></span></span><a class="reference internal" href="_modules/utils_v2/db_handler.html#DatabaseHandler.negate_new_player_announce"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#utils_v2.db_handler.DatabaseHandler.negate_new_player_announce" title="Link to this definition">¶</a></dt>
<dd><p><strong>(coroutine)</strong>
Resets the new player announcement flag for a user.</p>
<p>This sets <code class="docutils literal notranslate"><span class="pre">new_player_announce</span></code> to <code class="docutils literal notranslate"><span class="pre">False</span></code> in the database, indicating
that the new player arrival has been successfully processed and announced.</p>
<p>Accesses table : discord_osu</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>discord_id</strong> (class:<cite>int</cite>) – The user’s unique Discord ID.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><code class="docutils literal notranslate"><span class="pre">True</span></code> if the update was successful, <code class="docutils literal notranslate"><span class="pre">False</span></code> otherwise.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>bool</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="utils_v2.db_handler.DatabaseHandler.negate_top_play">
<span class="property"><span class="k"><span class="pre">async</span></span><span class="w"> </span></span><span class="sig-name descname"><span class="pre">negate_top_play</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">discord_id</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">bool</span></span></span><a class="reference internal" href="_modules/utils_v2/db_handler.html#DatabaseHandler.negate_top_play"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#utils_v2.db_handler.DatabaseHandler.negate_top_play" title="Link to this definition">¶</a></dt>
<dd><p><strong>(coroutine)</strong>
Resets the top play announcement flag for a user.</p>
<p>This sets <code class="docutils literal notranslate"><span class="pre">top_play_announce</span></code> to <code class="docutils literal notranslate"><span class="pre">False</span></code> in the database, indicating
that the pending top play has been successfully processed and announced.</p>
<p>Accesses table : discord_osu</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>discord_id</strong> (class:<cite>int</cite>) – The user’s unique Discord ID.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><code class="docutils literal notranslate"><span class="pre">True</span></code> if the update was successful, <code class="docutils literal notranslate"><span class="pre">False</span></code> otherwise.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>bool</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="utils_v2.db_handler.DatabaseHandler.new_player_detector">
<span class="property"><span class="k"><span class="pre">async</span></span><span class="w"> </span></span><span class="sig-name descname"><span class="pre">new_player_detector</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">list</span><span class="p"><span class="pre">[</span></span><span class="pre">dict</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">Any</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span></span><a class="reference internal" href="_modules/utils_v2/db_handler.html#DatabaseHandler.new_player_detector"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#utils_v2.db_handler.DatabaseHandler.new_player_detector" title="Link to this definition">¶</a></dt>
<dd><p><strong>(coroutine)</strong>
Retrieves a list of newly registered users waiting for an announcement.</p>
<p>This fetches identification and league data for all users marked with
<code class="docutils literal notranslate"><span class="pre">new_player_announce</span> <span class="pre">=</span> <span class="pre">True</span></code> in the database.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">new_player_announce</span></code> flag is set by the background worker in <code class="docutils literal notranslate"><span class="pre">supabase.py</span></code>
whenever a new player /links their account. This function detects those flags
and retrieves the data for all such players.</p>
<p>Accesses table : discord_osu</p>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>A list of user records containing ID, username, and league fields,
or <code class="docutils literal notranslate"><span class="pre">None</span></code> if no users are found or an error occurs.</p>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p>list[dict[str, Any]] | None</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="utils_v2.db_handler.DatabaseHandler.remove_player">
<span class="property"><span class="k"><span class="pre">async</span></span><span class="w"> </span></span><span class="sig-name descname"><span class="pre">remove_player</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">discord_id</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">bool</span></span></span><a class="reference internal" href="_modules/utils_v2/db_handler.html#DatabaseHandler.remove_player"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#utils_v2.db_handler.DatabaseHandler.remove_player" title="Link to this definition">¶</a></dt>
<dd><p><strong>(coroutine)</strong>
Permanently deletes a player from the database.</p>
<p>This removes the user’s row from <code class="xref py py-attr docutils literal notranslate"><span class="pre">DISCORD_OSU</span></code>.</p>
<p>Cascading deletion is enabled so once this function is called, the user’s
data is deleted from all table but rivals (and all their ongoing/ pending
challenges form rivals tables are delete too, but that’s done in a different
function)</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>discord_id</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code>) – The Discord ID of the user to remove.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><code class="docutils literal notranslate"><span class="pre">True</span></code> if the user was successfully deleted.
<code class="docutils literal notranslate"><span class="pre">False</span></code> if the user was not found or an error occurred.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><code class="xref py py-class docutils literal notranslate"><span class="pre">bool</span></code></p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="utils_v2.db_handler.DatabaseHandler.reset_seasonal_points">
<span class="property"><span class="k"><span class="pre">async</span></span><span class="w"> </span></span><span class="sig-name descname"><span class="pre">reset_seasonal_points</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">FuncStatus</span></span></span><a class="reference internal" href="_modules/utils_v2/db_handler.html#DatabaseHandler.reset_seasonal_points"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#utils_v2.db_handler.DatabaseHandler.reset_seasonal_points" title="Link to this definition">¶</a></dt>
<dd><p><strong>(coroutine)</strong>
Resets the seasonal points for all users to zero. (Usually called at the
end of the season)</p>
<p>Calls the RPC <code class="docutils literal notranslate"><span class="pre">reset_seasonal_points</span></code>. This is typically done immediately
after backing up the points for the previous season.</p>
<p>Accesses table : discord_osu</p>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p><code class="docutils literal notranslate"><span class="pre">FuncStatus.GOOD</span></code> if successful, <code class="docutils literal notranslate"><span class="pre">FuncStatus.ERROR</span></code> otherwise.</p>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p><code class="xref py py-class docutils literal notranslate"><span class="pre">FuncStatus</span></code></p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="utils_v2.db_handler.DatabaseHandler.revoke_challenge">
<span class="property"><span class="k"><span class="pre">async</span></span><span class="w"> </span></span><span class="sig-name descname"><span class="pre">revoke_challenge</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">challenge_id</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">bool</span></span></span><a class="reference internal" href="_modules/utils_v2/db_handler.html#DatabaseHandler.revoke_challenge"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#utils_v2.db_handler.DatabaseHandler.revoke_challenge" title="Link to this definition">¶</a></dt>
<dd><p><strong>(coroutine)</strong>
Marks a specific challenge as revoked (Pending -&gt; Revoked) in the rivals table.</p>
<p>Unlike accept/decline, this method performs a direct table update on
<code class="xref py py-attr docutils literal notranslate"><span class="pre">RIVALS</span></code> rather than calling an RPC function. Usually
called when some challenge becomes invalid due to internal error, or a
challenger wants to revoke their pending challenge with someone.</p>
<p>Accesses table : rivals</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>challenge_id</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code>) – The unique ID of the challenge to revoke.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><code class="docutils literal notranslate"><span class="pre">True</span></code> if the update was successful, <code class="docutils literal notranslate"><span class="pre">False</span></code> otherwise.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><code class="xref py py-class docutils literal notranslate"><span class="pre">bool</span></code></p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="utils_v2.db_handler.DatabaseHandler.seasonal_point_update">
<span class="property"><span class="k"><span class="pre">async</span></span><span class="w"> </span></span><span class="sig-name descname"><span class="pre">seasonal_point_update</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">FuncStatus</span></span></span><a class="reference internal" href="_modules/utils_v2/db_handler.html#DatabaseHandler.seasonal_point_update"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#utils_v2.db_handler.DatabaseHandler.seasonal_point_update" title="Link to this definition">¶</a></dt>
<dd><p><strong>(coroutine)</strong>
Synchronizes and awards seasonal points for all leagues. Done during
a season’s end</p>
<p>Iterates through every league table and performs two RPC calls per league:</p>
<ol class="arabic simple">
<li><p><code class="docutils literal notranslate"><span class="pre">sync_table_pp</span></code>: Ensures current pp matches the latest osu! API data.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">award_seasonal_points</span></code>: Calculates and distributes points for the season during it’s end</p></li>
</ol>
<p>If a league fails to update, the loop continues to the next one, but the
function will return an error status at the end.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">FuncStatus.GOOD</span></code>: All leagues updated successfully.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">FuncStatus.ERROR</span></code>: One or more leagues failed to update.</p></li>
</ul>
</p>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p><code class="xref py py-class docutils literal notranslate"><span class="pre">FuncStatus</span></code></p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="utils_v2.db_handler.DatabaseHandler.store_msg_id">
<span class="property"><span class="k"><span class="pre">async</span></span><span class="w"> </span></span><span class="sig-name descname"><span class="pre">store_msg_id</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">challenge_id</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">msg_id</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span><a class="reference internal" href="_modules/utils_v2/db_handler.html#DatabaseHandler.store_msg_id"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#utils_v2.db_handler.DatabaseHandler.store_msg_id" title="Link to this definition">¶</a></dt>
<dd><p><strong>(coroutine)</strong>
Links a Discord message ID to a specific challenge ID in the database.</p>
<p>This is used to track the public challenge message so the bot can later
update it or delete it if needed.</p>
<p>Accesses table : msg_id</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>challenge_id</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code>) – The unique ID of the challenge.</p></li>
<li><p><strong>msg_id</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code>) – The Discord message ID of the notification/embed sent to the channel.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="utils_v2.db_handler.DatabaseHandler.top_play_detector">
<span class="property"><span class="k"><span class="pre">async</span></span><span class="w"> </span></span><span class="sig-name descname"><span class="pre">top_play_detector</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">list</span><span class="p"><span class="pre">[</span></span><span class="pre">dict</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">Any</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span></span><a class="reference internal" href="_modules/utils_v2/db_handler.html#DatabaseHandler.top_play_detector"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#utils_v2.db_handler.DatabaseHandler.top_play_detector" title="Link to this definition">¶</a></dt>
<dd><p><strong>(coroutine)</strong>
Retrieves a list of users who have new top plays.</p>
<p>This fetches the identification data (osu!/Discord IDs) for all users
marked with <code class="docutils literal notranslate"><span class="pre">top_play_announce</span> <span class="pre">=</span> <span class="pre">True</span></code> in the database.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">top_play_announce</span></code> flag is set by the background worker in <code class="docutils literal notranslate"><span class="pre">supabase.py</span></code>
whenever a player achieves a new top play. This function detects those flags
and retrieves the data for all such players.</p>
<p>Accesses table : discord_osu</p>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>A list of user records containing ID and username fields,
or <code class="docutils literal notranslate"><span class="pre">None</span></code> if no users are found or an error occurs.</p>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p>list[dict[str, Any]] | None</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="utils_v2.db_handler.DatabaseHandler.update_init_pp">
<span class="property"><span class="k"><span class="pre">async</span></span><span class="w"> </span></span><span class="sig-name descname"><span class="pre">update_init_pp</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">league</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">FuncStatus</span></span></span><a class="reference internal" href="_modules/utils_v2/db_handler.html#DatabaseHandler.update_init_pp"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#utils_v2.db_handler.DatabaseHandler.update_init_pp" title="Link to this definition">¶</a></dt>
<dd><p><strong>(coroutine)</strong>
Updates the ‘initial_pp’ value for all users in for the given league
to the value in their corrsponding <cite>current_pp</cite> column in discord_osu
table. This is done thru RPC function.</p>
<p>Calls the RPC <code class="docutils literal notranslate"><span class="pre">update_init_pp</span></code>. This sets the user’s current PP as their
starting PP for the new season or period.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>league</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code>) – The name of the league table to update.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><code class="docutils literal notranslate"><span class="pre">FuncStatus.GOOD</span></code> if successful, <code class="docutils literal notranslate"><span class="pre">FuncStatus.ERROR</span></code> otherwise.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><code class="xref py py-class docutils literal notranslate"><span class="pre">FuncStatus</span></code></p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="utils_v2.db_handler.DatabaseHandler.update_leagues">
<span class="property"><span class="k"><span class="pre">async</span></span><span class="w"> </span></span><span class="sig-name descname"><span class="pre">update_leagues</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">list</span><span class="p"><span class="pre">[</span></span><span class="pre">dict</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">Any</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span></span><a class="reference internal" href="_modules/utils_v2/db_handler.html#DatabaseHandler.update_leagues"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#utils_v2.db_handler.DatabaseHandler.update_leagues" title="Link to this definition">¶</a></dt>
<dd><p><strong>(coroutine)</strong>
Identifies and processes users who need to be transferred between leagues.</p>
<p>This process involves:
1. Fetching mismatched rows (users whose PP no longer fits their current league).
2. Processing each transfer individually via <code class="xref py py-meth docutils literal notranslate"><span class="pre">_process_single_transfer()</span></code>.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>A list of player dictionaries representing successful transfers.
Returns <code class="docutils literal notranslate"><span class="pre">None</span></code> if fetching mismatched rows failed.</p>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p><code class="xref py py-class docutils literal notranslate"><span class="pre">list`[:class:`dict`[:class:`str</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">Any</span></code>]] | None</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="utils_v2.db_handler.DatabaseHandler.validate_shared_league">
<span class="property"><span class="k"><span class="pre">async</span></span><span class="w"> </span></span><span class="sig-name descname"><span class="pre">validate_shared_league</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">discord_id</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">league</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/utils_v2/db_handler.html#DatabaseHandler.validate_shared_league"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#utils_v2.db_handler.DatabaseHandler.validate_shared_league" title="Link to this definition">¶</a></dt>
<dd><p><strong>(coroutine)</strong>
Checks if a user belongs to a specific league.</p>
<p>This performs a lightweight “head” query (counting rows without fetching data)
to verify if the user exists in the specified league.</p>
<p>Accesses table : discord_osu</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>discord_id</strong> (class:<cite>int</cite>) – The user’s unique Discord ID.</p></li>
<li><p><strong>league</strong> (class:<cite>str</cite>) – The name of the league to check (e.g., “gold”).</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><code class="docutils literal notranslate"><span class="pre">True</span></code> if the user is in the specified league, <code class="docutils literal notranslate"><span class="pre">False</span></code> otherwise.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>bool</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="Main">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="index.html">OsuArena</a></h1>









<search id="searchbox" style="display: none" role="search">
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" placeholder="Search"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</search>
<script>document.getElementById('searchbox').style.display = "block"</script><h3>Navigation</h3>
<p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">Database API</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#utils_v2.db_handler.DatabaseHandler"><code class="docutils literal notranslate"><span class="pre">DatabaseHandler</span></code></a></li>
</ul>
</li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="index.html">Documentation overview</a><ul>
      <li>Previous: <a href="index.html" title="previous chapter">OsuArena documentation</a></li>
  </ul></li>
</ul>
</div>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &#169;2026, Rhythmic-Ocean.
      
      |
      Powered by <a href="https://www.sphinx-doc.org/">Sphinx 9.1.0</a>
      &amp; <a href="https://alabaster.readthedocs.io">Alabaster 1.0.0</a>
      
      |
      <a href="_sources/db_handler.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>